// 1. DBへの接続設定
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// --------------------------------------
// 1. ユーザー情報 (Master Table)
// --------------------------------------
model User {
  userId    String   @id // DiscordのIDをそのまま主キー(PK)にする
  username  String   // 最新のユーザー名
  updatedAt DateTime @updatedAt // 更新された時間を自動記録
  createdAt DateTime @default(now())

  // リレーション: 1人のユーザーは複数のログを持つ
  activityLogs   ActivityLog[]
  userStatusLogs UserStatusLog[]
}

// --------------------------------------
// 2. アクティビティログ (Transaction Table)
// --------------------------------------
model ActivityLog {
  id              Int      @id @default(autoincrement())
  
  // 紐付け設定
  userId          String
  user            User     @relation(fields: [userId], references: [userId])

  // username は削除しました (Userテーブルのものを見るから不要)
  
  activityName String
  startTime       DateTime @default(now())
  endTime         DateTime?
  isUnexpectedEnd Boolean @default(false)
  createdAt       DateTime @default(now())
}

// --------------------------------------
// 3. ステータスログ (Transaction Table)
// --------------------------------------
model UserStatusLog {
  id              Int      @id @default(autoincrement())
  
  // 紐付け設定
  userId          String
  user            User     @relation(fields: [userId], references: [userId])
  
  status          String
  startTime       DateTime @default(now())
  endTime         DateTime?
  isUnexpectedEnd Boolean @default(false)
  createdAt       DateTime @default(now())

  @@index([userId])
}